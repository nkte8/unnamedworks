---
import { getAllPosts, getLatestHighlight, create_ogp_urlquery } from "@/utils/newt.ts";
// 最新記事取得部分
import Data from "@/utils/model/postformat.json";
type Post = typeof Data;
const post_response = await getAllPosts();
const posts: Post[] = post_response?.items;

// ハイライト取得部分
import Highlight from "@/utils/model/highlightformat.json";
type Highlight = typeof Highlight;
const highlight_respose = await getLatestHighlight();
const hightlight: Highlight = highlight_respose?.items[0];
const img_highlight = "url(" + hightlight.image.src + "?format=auto)";

// 以降レイアウト関連
import BaseLayout from "@/layouts/BookLayout.astro";
import Menu from "@/components/menu/main.astro";
import Pagelist_buttons from "@/components/pagelink_buttons/main.astro";

const pageUrl = "/";

// cardは切り抜いて自動生成
const card_urlquery = create_ogp_urlquery(
                        hightlight.image.width,
                        hightlight.image.height,
                        hightlight.ogp_focus_bottom)
const cardUrl = hightlight.image.src + card_urlquery

import { global_vars } from "@/utils/vars.ts";
export const baseurl = global_vars.baseurl;
const pageTitle = global_vars.website_title;

import { Image } from 'astro:assets';
import img_cover from "@/images/cover.png"
const css = "background-image: " + img_highlight
---
<style define:vars={{ img_highlight }}>
    img {
        width: 100%;
        height: auto;
        margin-top:-0.5%;
        margin-bottom: 1%;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom 20%;
        {/* 
            Imageコンポーネントだとdefine:vars定義の変数が効かないらしく(素のimgは可)
            以下は設定しても正常に作用しない。そのためImageを使いつつbackgroundを表示するには
            styleに直接記載するしかない。
        */}
        {/* 
            background-image: var(--img_highlight);
        */}
    }
</style>
<BaseLayout pageTitle={pageTitle} page_url={pageUrl} cardUrl={cardUrl}>
    <Menu slot="header" />
    <Image src={img_cover} alt="" style={css} />
    <Pagelist_buttons
        slot="footer"
        baseurl={baseurl}
        nextpage_slug={false}
        prevpage_slug={posts[0].slug}
        currentpage_title={pageTitle}
    />
</BaseLayout>